{"ast":null,"code":"import _typeof from \"/explorer/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.object.entries.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.array.flat.js\";\nimport \"core-js/modules/es.array.unscopables.flat.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/es.string.replace-all.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { BRow, BCol, BAlert, BCard, BTable, BFormCheckbox, BCardHeader, BCardTitle, BMedia, BMediaAside, BMediaBody, BAvatar, BCardBody, BLink, BButtonGroup, BButton, BTooltip, VBModal, VBTooltip, BCardFooter } from 'bootstrap-vue';\nimport { formatNumber, formatTokenAmount, isToken, percent, timeIn, toDay, toDuration, tokenFormatter, getLocalAccounts, getStakingValidatorOperator } from '@/libs/utils';\nimport OperationModal from '@/views/components/OperationModal/index.vue';\nimport Ripple from 'vue-ripple-directive';\nimport dayjs from 'dayjs';\nimport ParametersModuleComponent from './components/parameters/ParametersModuleComponent.vue';\nimport DashboardCardHorizontal from './components/dashboard/DashboardCardHorizontal.vue';\nimport DashboardCardVertical from './components/dashboard/DashboardCardVertical.vue';\nimport DashboardPriceChart2 from './components/dashboard/DashboardPriceChart2.vue';\nimport FeatherIcon from '../@core/components/feather-icon/FeatherIcon.vue';\nexport default {\n  components: {\n    BAvatar: BAvatar,\n    BButtonGroup: BButtonGroup,\n    BTooltip: BTooltip,\n    BButton: BButton,\n    BRow: BRow,\n    BCol: BCol,\n    BAlert: BAlert,\n    BCard: BCard,\n    BTable: BTable,\n    BFormCheckbox: BFormCheckbox,\n    BCardHeader: BCardHeader,\n    BCardTitle: BCardTitle,\n    BMediaBody: BMediaBody,\n    BMediaAside: BMediaAside,\n    BMedia: BMedia,\n    BCardBody: BCardBody,\n    BLink: BLink,\n    BCardFooter: BCardFooter,\n    OperationModal: OperationModal,\n    ParametersModuleComponent: ParametersModuleComponent,\n    DashboardCardHorizontal: DashboardCardHorizontal,\n    DashboardPriceChart2: DashboardPriceChart2,\n    DashboardCardVertical: DashboardCardVertical,\n    FeatherIcon: FeatherIcon\n  },\n  directives: {\n    'b-modal': VBModal,\n    'b-tooltip': VBTooltip,\n    Ripple: Ripple\n  },\n  data: function data() {\n    return {\n      fields: ['validator', 'delegation', 'rewards', 'action'],\n      delegations: [],\n      rewards: [],\n      unbonding: [],\n      chain: this.$store.state.chains.selected.chain_name,\n      syncing: false,\n      latestTime: '',\n      marketData: null,\n      height: '-',\n      supply: '-',\n      bonded: '-',\n      validators: '-',\n      communityPool: '-',\n      ratio: '-',\n      inflation: '-',\n      proposals: [],\n      myVotes: {},\n      selectedValidator: '',\n      selectedProposalId: 0,\n      selectedTitle: '',\n      operationModalType: '',\n      voteColors: {\n        YES: 'success',\n        NO: 'warning',\n        ABSTAIN: 'info',\n        NO_WITH_VETO: 'danger'\n      },\n      walletBalances: '-',\n      walletStaking: '-',\n      walletRewards: '-',\n      walletUnbonding: '-',\n      address: null\n    };\n  },\n  computed: {\n    walletName: function walletName() {\n      var _this$$store,\n          _this$$store$state,\n          _this$$store$state$ch,\n          _this = this;\n\n      var key = (_this$$store = this.$store) === null || _this$$store === void 0 ? void 0 : (_this$$store$state = _this$$store.state) === null || _this$$store$state === void 0 ? void 0 : (_this$$store$state$ch = _this$$store$state.chains) === null || _this$$store$state$ch === void 0 ? void 0 : _this$$store$state$ch.defaultWallet;\n\n      if (key) {\n        var accounts = getLocalAccounts() || {};\n        var account = Object.entries(accounts).map(function (v) {\n          return {\n            wallet: v[0],\n            address: v[1].address.find(function (x) {\n              return x.chain === _this.$store.state.chains.selected.chain_name;\n            })\n          };\n        }).filter(function (v) {\n          return v.address;\n        }).find(function (x) {\n          return x.wallet === key;\n        });\n\n        if (account) {\n          this.fetchAccount(account.address.addr);\n        }\n      }\n\n      return key || 'Wallet';\n    },\n    proprosals2: function proprosals2() {\n      return this.proposals;\n    },\n    stakingList: function stakingList() {\n      var _this2 = this;\n\n      return this.delegations.map(function (x) {\n        var rewards = _this2.rewards.find(function (r) {\n          return r.validator_address === x.delegation.validator_address;\n        });\n\n        return {\n          valAddress: x.delegation.validator_address,\n          validator: getStakingValidatorOperator(_this2.$store.state.chains.selected.chain_name, x.delegation.validator_address),\n          delegation: _this2.formatToken([x.balance]),\n          rewards: rewards ? _this2.formatToken(rewards.reward) : '',\n          action: ''\n        };\n      });\n    }\n  },\n  created: function created() {\n    var _this3 = this;\n\n    this.$http.getGovernanceListByStatus(2).then(function (res) {\n      _this3.proposals = res.proposals;\n    });\n    this.$http.getLatestBlock().then(function (res) {\n      _this3.height = res.block.header.height;\n\n      if (timeIn(res.block.header.time, 3, 'm')) {\n        _this3.syncing = true;\n      } else {\n        _this3.syncing = false;\n      }\n\n      _this3.latestTime = toDay(res.block.header.time, 'long');\n      _this3.validators = res.block.last_commit.signatures.length;\n    });\n    this.$http.getStakingParameters().then(function (res) {\n      Promise.all([_this3.$http.getStakingPool(), _this3.$http.getBankTotal(res.bond_denom)]).then(function (pool) {\n        _this3.supply = \"\".concat(formatNumber(formatTokenAmount(pool[1].amount, 2, res.bond_denom, false), true, 2));\n        _this3.bonded = \"\".concat(formatNumber(formatTokenAmount(pool[0].bondedToken, 2, res.bond_denom, false), true, 2));\n        _this3.ratio = \"\".concat(percent(pool[0].bondedToken / pool[1].amount), \"%\");\n      });\n    });\n    this.$http.getCommunityPool().then(function (res) {\n      _this3.communityPool = _this3.formatToken(res.pool);\n    });\n    var conf = this.$http.getSelectedConfig();\n\n    if (conf.excludes && conf.excludes.indexOf('mint') > -1) {\n      this.inflation = '-';\n    } else {\n      this.$http.getMintingInflation().then(function (res) {\n        _this3.inflation = \"\".concat(percent(res), \"%\");\n      }).catch(function () {\n        _this3.inflation = '-';\n      });\n    }\n  },\n  methods: {\n    selectProposal: function selectProposal(modal, pid, title) {\n      this.operationModalType = modal;\n      this.selectedProposalId = Number(pid);\n      this.selectedTitle = title;\n    },\n    selectDelegation: function selectDelegation(v, type) {\n      this.selectedValidator = v.item.valAddress;\n      this.operationModalType = type;\n    },\n    selectSend: function selectSend() {\n      this.operationModalType = 'Transfer';\n    },\n    selectWithdraw: function selectWithdraw() {\n      this.operationModalType = 'Withdraw';\n    },\n    formatToken: function formatToken(tokens) {\n      if (Array.isArray(tokens)) {\n        var nativeToken = tokens.filter(function (x) {\n          return x.denom.length < 11;\n        });\n\n        if (tokens.length > 1) {\n          var sum = {};\n          var reduce = nativeToken.reduce(function (b, a) {\n            var b2 = b;\n\n            if (b2[a.denom]) {\n              b2[a.denom] += Number(a.amount);\n            } else {\n              b2[a.denom] = Number(a.amount);\n            }\n\n            return b2;\n          }, sum);\n          nativeToken = Object.keys(reduce).map(function (k) {\n            return {\n              denom: k,\n              amount: reduce[k]\n            };\n          });\n        }\n\n        return tokenFormatter(nativeToken, {}, 0);\n      }\n\n      return '-';\n    },\n    fetchAccount: function fetchAccount(address) {\n      var _this4 = this;\n\n      this.address = address;\n      this.$http.getBankAccountBalance(address).then(function (bal) {\n        _this4.walletBalances = _this4.formatToken(bal);\n      });\n      this.$http.getStakingReward(address).then(function (res) {\n        _this4.rewards = res.rewards;\n        _this4.walletRewards = _this4.formatToken(res.rewards.map(function (x) {\n          return x.reward;\n        }).flat());\n      });\n      this.$http.getStakingDelegations(address).then(function (res) {\n        var delegations = res.delegation_responses || res;\n        _this4.delegations = delegations;\n        _this4.walletStaking = _this4.formatToken(delegations.map(function (x) {\n          return x.balance;\n        }).flat());\n      });\n      this.$http.getStakingUnbonding(address).then(function (res) {\n        var token = _this4.$store.state.chains.selected.assets[0];\n\n        if (token) {\n          var newTokens = [];\n          var denom = token.base;\n          var unbonding = res.unbonding_responses || res;\n          _this4.unbonding = unbonding;\n          unbonding.forEach(function (x) {\n            x.entries.forEach(function (y) {\n              newTokens.push({\n                amount: y.balance,\n                denom: denom\n              });\n            });\n          });\n\n          if (newTokens.length > 0) {\n            _this4.walletUnbonding = _this4.formatToken(newTokens);\n          }\n        }\n      });\n      this.proposals.forEach(function (x) {\n        _this4.$http.getGovernanceProposalVote(x.id, address, null).then(function (v) {\n          _this4.myVotes[x.id] = _this4.formatVoteOption(v.vote.option);\n        }).catch(function () {\n          _this4.myVotes[x.id] = null;\n        });\n      });\n    },\n    formatVoteOption: function formatVoteOption(v) {\n      return v.replaceAll('VOTE_OPTION_', '');\n    },\n    formatEnding: function formatEnding(v) {\n      return toDay(v, 'from');\n    },\n    formatType: function formatType(v) {\n      var txt = String(v).replace('Proposal', '');\n      var index = txt.lastIndexOf('.');\n      return index > 0 ? txt.substring(index + 1) : txt;\n    },\n    normalize: function normalize(data, title) {\n      if (!data) return null;\n      var items = this.makeItems(data);\n      return {\n        title: title,\n        items: items\n      };\n    },\n    makeItems: function makeItems(data) {\n      var _this5 = this;\n\n      return Object.keys(data).map(function (k) {\n        if (isToken(data[k])) {\n          return {\n            title: tokenFormatter(data[k]),\n            subtitle: k\n          };\n        }\n\n        if (typeof data[k] === 'boolean') {\n          return {\n            title: data[k],\n            subtitle: k\n          };\n        }\n\n        return {\n          title: _this5.convert(data[k]),\n          subtitle: k\n        };\n      });\n    },\n    formatDate: function formatDate(v) {\n      return dayjs(v).format('YYYY-MM-DD HH:mm:ss');\n    },\n    convert: function convert(v) {\n      var _this6 = this;\n\n      if (_typeof(v) === 'object') {\n        var v2 = {};\n        Object.entries(v).forEach(function (e) {\n          var k = e[0];\n          var x = e[1];\n          v2[k] = _this6.convert(x);\n        });\n        return v2;\n      }\n\n      var d = parseFloat(v);\n      if (d === 0) return '0';\n\n      if (d < 1.01) {\n        return \"\".concat(percent(d), \"%\");\n      }\n\n      if (d > 1000000000) {\n        return \"\".concat(toDuration(d / 1000000));\n      }\n\n      if (d > 0) {\n        return d.toFixed();\n      }\n\n      return v;\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}